#!/usr/bin/python3

import nmap
import subprocess
from fpdf import FPDF

def perform_http_scans(target, report_filename="http_scan_report.pdf"):
    # Perform HTTP vulnerability scans if port 80 is open.
    http_scans = {
        "http_trace_track": ["curl", "-v", "-X", "TRACE", f"{target}:80"],
        "apache_etag_header": ["curl", "-v", "-X", "GET", f"{target}:80"],
        "http_sys_rce": ["curl", "-v", f"{target}:80/", "-H", "Host: irrelevant", "-H", "Range: bytes=0-18446744073709551615"]
    }

    print("Starting HTTP vulnerability scans...")
    scan_results = []

    for scan_name, scan_command in http_scans.items():
        print(f"Running {scan_name}...")
        result = subprocess.run(scan_command, capture_output=True, text=True)
        scan_results.append((scan_name, result.stdout + result.stderr))

    print("Completed HTTP vulnerability scans.")
    
    # Generate PDF report
    pdf = FPDF()
    pdf.add_page()
    pdf.set_font("Arial", size=12)
    
    pdf.cell(200, 10, txt="HTTP Vulnerability Scans Report", ln=True, align='C')

    for scan_name, output in scan_results:
        pdf.ln(10)  # Add a line break
        pdf.cell(200, 10, txt=scan_name, ln=True)
        pdf.multi_cell(0, 10, txt=output)

    pdf.output(report_filename)
    print(f"Report saved as {report_filename}")